<!--Menu-->
<div class="row">
   <div class="col-md-6 ">
      <p><%= link_to "Inicio",  root_path, :class => "linka" %>  <%= link_to "| Reportes",  reports_path, :class => "linka" %>
         <%if view_report(@report)%>
         <%= link_to "| Reporte (#{@report.codigo})",  @report, :class => "linka" %> <%= link_to "| #{@accion.tipo}es",  @accion.tipo == "Accion" ? report_accions_path(@report) : report_correcciones_path(@report), :class => "linka" %> <%end%>
      </p>
   </div>
   <div class="col-md-6 text-right">
      <p> <%if view_report(@report)%>
         <%= link_to  edit_report_accion_path(@report,@accion), :class => "opciones2" do %>
         <i class="fa fa-pencil" aria-hidden="true"></i>
         <% end %>
         <% end %>
         <%= link_to  report_accion_path(@report,@accion),  method: :delete, data: { confirm: 'Are you sure?' }, :class => "opciones2" do %>
         <i class="fa fa-trash" aria-hidden="true"></i>
         <% end %>
      </p>
   </div>
</div>
<!--/Menu-->
<!--Formulario para cambiar estado de accion-->
<%= render 'form_change', accion: @accion %>
<!--/Formulario para cambiar estado de accion-->
<!--Menu Tabs-->
<%= render 'tabs'%>
<!--/Menu Tabs-->
<!--Alerta de cierre o solicitud de cierre-->
<%if @accion.estado != "Cerrada"   &&  @accion.s_cierre%>
<div class="alert alert-success text-center" > 
   <i class="fa fa-thumbs-o-up" style = "font-size:30px;margin-right: 15px;" aria-hidden="true"></i>¡EL RESPONSABLE DE LA EJECUCION SOLICITO EL CIERRE DE LA ACCION!
</div>
<%end%>
<% if @accion.estado == "Cerrada"  %>
<% if @accion.cumplio %>
<div class="alert alert-success text-center" > 
   <i class="fa fa-thumbs-o-up" style = "font-size:30px;margin-right: 15px;" aria-hidden="true"></i>¡LA ACCION SE CERRO Y SE CUMPLIO CON LA FECHA ! 
</div>
<%else%>
<div class="alert alert-danger text-center" > 
   <i class="fa fa-thumbs-o-down" style = "font-size:30px;margin-right: 15px;" aria-hidden="true"></i>¡LA ACCION REPORTE SE CERRO CON EXITO PERO NO SE CUMPLIO CON LA FECHA! <button style = "margin-left:50px" type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#accion_change_state">¿Cumplio?</button>
</div>
<%end%>
<%end%>
<!--/Alerta de cierre o solicitud de cierre-->
<div class="modal fade" id="myModal" role="dialog">
   <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content">
         <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title modalp1">Informacion del Reporte</h4>
         </div>
         <div class="modal-body">
            <table class = "reporte">
               <tr>
                  <th>Codigo</th>
                  <td><%= @report.codigo %></td>
                  <th>Fuente</th>
                  <td><%= @report.source.name %></td>
               </tr>
               <tr>
                  <th>Descripcion</th>
                  <td colspan="3"><%= @report.description%></td>
               </tr>
            </table>
         </div>
         <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
         </div>
      </div>
   </div>
</div>
<!--Muestra Informacion y seguimiento-->
<div class = "row">
<!--Informacion-->
   <div class="col-md-6 wihtout-padding">
      <h3 class = "linka htitle text-center"><%=@accion.tipo %> del Reporte
         (<a class="btn linka" style = "font-size:18px;" data-toggle="modal" data-target="#myModal" ><%= @report.codigo%></a>)
      </h3>
      <div class="conteinter reporte cnt">
         <div class="row rtr name">
            <div class="col-md-12 rtd"><%=@accion.name%></div>
         </div>
         <hr>
         <div class="row rtr">
            <%if @accion.causa_efectos.exists?%>
            <div class="col-md-12 rtd"><strong>Causas: </strong><%= @accion.causa_efectos.pluck(:name).join(", ") %></div>
            <%end%>
            <div class="col-md-2 rtd"><strong>Creacion:</strong> <%= get_date(@accion.created_at) %></div>
            <div class="col-md-2 rtd"><strong>Codigo:</strong> <%= @accion.codigo %></div>
            <% employed1 = Employed.find(@accion.employed_id)%>
            <div class="col-md-2 rtd"><strong>Reporta: </strong><%= employed1.first_name %> <%= employed1.first_last_name %></div>
            <div class="col-md-2 rtd"><strong>Estado: </strong><%= @accion.estado %></div>
            <div class="col-md-2 rtd"><strong>Costo: </strong><%= number_to_currency(@accion.costo) %></div>
         </div>
         <hr>
         <div class="row rtr">
            <div class="col-md-6 rtd"><strong>Responsable:</strong> <% employed = Employed.find(@accion.employed_id)%>
               <%= employed.first_name %> <%= employed.first_last_name %><br>
               <strong>Responsable de Cierre:</strong> <% employed = Employed.find(@accion.cierra_id)%>
               <%= employed.first_name %> <%= employed.first_last_name %>
               <br>
               <strong>Otros Interesados: </strong><% 
                  cm = 0 
                  @accion.employeds.each do |resp|
                    %><%= "," if cm != 0 %> 
               <button type="button" class="btn numerb" data-container="body" data-toggle="popover" data-placement="top" data-content="<p style='text-align:center;margin:0px;padding:0px;'><img src='<%= resp.avatare_url(:thumb) %>'></p><br><strong>Cargo: </strong><%=resp.cargo.name %><br> <strong>Email:</strong> <%= resp.email%><br><strong>Cedula:</strong> <%= resp.document %>"><%= resp.first_name %> <%= resp.first_last_name %></button>
               <%  cm = cm + 1 %> 
               <%end%>
            </div>
            <div class="col-md-6 rtd"><strong>Fecha de Entrega: </strong> <%= get_date(@accion.f_compromiso) if @accion.fp_seguimiento %><strong style = "margin-left:10px;">Fecha de seguimiento: </strong> <%= get_date(@accion.fp_seguimiento) if @accion.fp_seguimiento %><br><strong>Dias para el cierre: </strong><%=@accion.contador_seg %><strong  style = "margin-left:10px;">Frecuencia de Seguimiento: </strong><%=f_seguimiento(@accion.f_seguimiento) %></div>
         </div>
         <hr>
         <div class="row rtr">
           <div class="col-md-12 rtd text-left">
               <div class="descnum"><strong>Descripcion:</strong> <%= @accion.descripcion%></div>
            </div>
            <div class="col-md-12 rtd text-left">
               <strong>Posible Evidencia:</strong> <%= @accion.evidencia%>
            </div>
            <!--<div class="col-md-12 rtd"><strong>Descripcion</strong></div>-->
          
         </div>
      </div>
   </div>
   <!--/Informacion-->
   <!--Seguimiento-->
   <div class="col-md-6 wihtout-padding">
      <div class="conteinter htitle" style = "padding:0px">
         <div class="row rtr">
            <div class="col-md-2 rtd"></div>
            <div class="col-md-8 rtd">
               <h3 class="htitle linka text-center">Seguimientos (<%=@accion.aseguimientos.count %>)</h3>
            </div>
            <div class="col-md-2 rtd">
               <% if @seguimientos.count > 0 %>
               <%= link_to 'Nuevo Seguimiento', new_report_accion_aseguimiento_path(@report,@accion), remote: true,:class => 'btn btn-primary pull-right' %><%end%>
            </div>
         </div>
      </div>
      <% if @seguimientos.count > 0 %>
            <% @seguimientos.each do |seg| %>
               <% if seg.cierra %>
                  <div class="conteinter reporte cnt">
                          <div class="row rtr">
                                  <div class="col-md-4 rtd linka cierra">Seguimiento que cierra la Accion</div>
                                  <div class="col-md-2 rtd"><strong>Creacion:</strong> <%= get_date(seg.created_at) %></div>
                                  <div class="col-md-2 rtd">
                                    <strong>Responsable:</strong> <%  idemp = User.find(seg.user_id).email
                                        employed = Employed.where(email: idemp).take
                                        %>
                                    <td  class = "imaacc">
                                        <%= employed.first_name %> <%= employed.first_last_name %>
                                  </div>
                                  <div class="col-md-2 rtd"><strong>Evidencia: </strong><%= link_to "Ver Evidencia", seg.evidencia_url if seg.evidencia_url %><%=image_tag get_extension(seg.evidencia.file.extension) if seg.evidencia_url%></div>
                                  <div class="col-md-2 rtd text-right"><%= link_to  edit_report_accion_aseguimiento_path(@report,@accion,seg),remote: true, :class => "opciones" do %>
                                  <i class="fa fa-pencil" aria-hidden="true"></i>
                                  <% end %>
                                  <%= link_to  report_accion_aseguimiento_path(@report,@accion,seg),  method: :delete, data: { confirm: 'Are you sure?' }, :class => "opciones" do %>
                                  <i class="fa fa-trash" aria-hidden="true"></i>
                                  <% end %>
                                  </div>
                          </div>
                          <hr>
                          <div class="row rtr">
                              <div class="col-md-12 rtd text-left"><strong>Descripcion: </strong> <%= seg.descripcion %></div>
                          </div>
                          <hr>
                          <div class="row rtr">
                                <div class="col-md-3 rtd text-left"><strong>¿Eficaz?: </strong><% if  seg.eficaz%>
                                <i class="fa fa-thumbs-o-up" style = "font-size:30px;margin-right: 15px;" aria-hidden="true"></i>
                                <%else %>
                                <i class="fa fa-thumbs-o-down" style = "font-size:30px;margin-right: 15px;" aria-hidden="true"></i>
                                <%end %></div>
                                  <div class="col-md-6 rtd text-left" style = "margin-top: 13px;"><strong>Conclusión: </strong> <%= seg.conclucion %></div>
                                  <div class="col-md-3 rtd text-left" style = "margin-top: 13px;"><strong>Costo: </strong> <%= number_to_currency(seg.costo)%>
                                  </div>
                          </div>
                  </div>
                  <%else%>
                      <div class="conteinter reporte cnt ">
                        <div class="row rtr">
                            <div class="col-md-1">
                            <%  idemp = User.find(seg.user_id).email
                              employed1 = Employed.where(admin_user: current_user.admin_user, email: idemp).first
                              %>
                            <img class ="seg-img" src='<%= employed1.avatare_url(:thumb) %>'>
                            </div>
                            <div class="col-md-11">
                            <div class="col-md-4 rtd wihtout-padding-bot">
                            <%= employed1.first_name %> <%= employed1.first_last_name %>
                            </div>
                            <div class="col-md-3 rtd wihtout-padding-bot"><strong><i class="fa fa-calendar" aria-hidden="true"></i></strong> <%=  get_date(seg.created_at)  %></div>
                            <div class="col-md-3 rtd "><strong><i class="fa fa-paperclip" aria-hidden="true"></i> </strong><%= (link_to "Evidencia",seg.evidencia_url, class:"linka") if seg.evidencia_url %></div>
                            <div class="col-md-2 rtd text-right wihtout-padding-bot"><%= link_to  edit_report_accion_aseguimiento_path(@report,@accion,seg),remote: true, :class => "opciones" do %>
                            <i class="fa fa-pencil" aria-hidden="true"></i>
                            <% end %>
                            <%= link_to  report_accion_aseguimiento_path(@report,@accion,seg),  method: :delete ,data: { confirm: 'Are you sure?' }, :class => "opciones" do %>
                            <i class="fa fa-trash" aria-hidden="true"></i>
                            <% end %>
                            </div>
                            <div class="col-md-12 wihtout-padding-top text-left"><%= seg.descripcion %></div>
                            </div>
                        </div>
                      </div>
                  <% end %>
          <% end %>
      <% else %>
            <div class="jumbotron jumbacc">
            <h3 class="display-3 text-gray">No se ha creado ningun seguimiento</h3>
            <hr class="my-4">
            <br>
            <br>
            <%= link_to 'Nuevo Seguimiento', new_report_accion_aseguimiento_path(@report,@accion), remote:true,:class => 'btn btn-primary btn-lg'  %>
            </p>
            </div>
      <% end %>
   </div>
   <!--Seguimiento-->
</div>

<!--/Muestra Informacion y seguimiento-->

<!--Tareas-->
<div class="row">
<!--Tareas Abiertas-->
    <div class="col-md-6 wihtout-padding">
          <div class="conteinter htitle" style = "padding:0px">
                  <div class="row rtr">
                        <div class="col-md-2 rtd"></div>
                        <div class="col-md-7 rtd">
                        <h4 class="linka margin-cero"><i style = "font-size:20px"  class="fa fa-unlock" aria-hidden="true"></i> TAREAS ABIERTAS (<%= @tasks.count %>)</h4>
                        </div>
                        <% if @tasks_all.count > 0 %>
                        <div class="col-md-3 rtd"><strong><%= (link_to "+ Nueva Tarea", new_report_accion_task_path(@report,@accion),remote:true, :class => 'linka pull-right') if (current_user.rol ? current_user.rol.configuracion : false) || current_user.role == "SuperAdmin" %></strong></div>
                        <% end %>
                  </div>
          </div>
          <% if @tasks_all.count > 0 %>
                  <% @tasks.each do |task| %>
                      <%=link_to report_accion_task_path(@report,@accion,task) do %>
                      <div class="conteinter reporte cnt">
                          <div class="row rtr">
                          <div class="col-md-8 rtd text-left" style = "    padding: 5px !important;
                            padding-left: 17px !important;font-size:13px;"><strong >Tarea: </strong><span style = "font-weight:100"><%= task.name %></span></div>
                          <div class="col-md-4 text-right" style = "padding-left: 40px !importan;padding-top: 0px !important;
                            padding-bottom: 0px !important;   padding-right: 40px !important;">
                          <!--<%= link_to  edit_report_accion_task_path(@report,@accion,task) + "?tipo=do",remote:true, :class => "opciones" do %>
                            <i class="fa fa-thumb-tack" aria-hidden="true"></i>
                            
                              <% end %>
                              <%= link_to  report_accion_task_path(@report,@accion,task), :class => "opciones" do %>
                              <i class="fa fa-eye" aria-hidden="true"></i><%end%>
                              <% if current_user.id == task.user_id%>
                              <%= link_to  edit_report_accion_task_path(@report,@accion,task),remote:true, :class => "opciones" do %>
                              <i class="fa fa-pencil" aria-hidden="true"></i>
                              <% end %>
                              
                              <%= link_to  report_accion_task_path(@report,@accion,task),  method: :delete, data: { confirm: 'Are you sure?' }, :class => "opciones" do %>
                              <i class="fa fa-trash" aria-hidden="true"></i>
                            
                              <% end %> <% end %>-->
                          </div>
                          </div>
                          <hr class="hr">
                          <div class="row rtr">
                                  <div class="col-md-4 rtd">
                                        <strong><i class="fa fa-user" aria-hidden="true"></i>
                                        </strong> <%  
                                          employed = Employed.find(task.employed_id)
                                          %>
                                      
                                    <%= employed.first_name %> <%= employed.first_last_name %>
                                  </div>
                                    <%color = ""
                                      task.contador_seg < 0 ?  color = "#d82c2c" : color = "orange"
                                      color = "#0db4a0" if task.contador_seg > 5%>
                                    <div class="col-md-4 rtd" style = "color:white;background:<%=color%>"><strong><i class="fa fa-calendar" aria-hidden="true"></i>
                                    </strong> <%=  get_date(task.f_compromiso)  %></div>
                                  <div class="col-md-4 rtd" style = "    font-size: 12px;
                                    color: gray;"><%=  task.codigo  %></div>
                          </div>
                        </div>
                        <% end %>
                  <%end%>
                  <%else%>
                        <div class="jumbotron jumbacc">
                        <h3 class="display-3 text-gray">No se ha creado ninguna Tarea</h3>
                        <hr class="my-4"><br>
                        <%= (link_to "Nueva Tarea", new_report_accion_task_path(@report,@accion) ,remote: true, :class => 'btn btn-primary btn-lg') if (current_user.rol ? current_user.rol.configuracion : false) || (current_user.role == "SuperAdmin") %>
                        </p></div>
          <%end%>
        </div>
        <!--/Tareas Abiertas-->
        <!--Tareas Cerradas-->
        <div class="col-md-6 wihtout-padding">
         <div class="conteinter htitle" style = "padding:0px">
                     <div class="row rtr">
                     <div class="col-md-2 rtd"></div>
                     <div class="col-md-8 rtd">
                     <h4 class="linka margin-cero"><i style = "font-size:20px"  class="fa fa-lock" aria-hidden="true"></i> TAREAS CERRADAS (<%= @tasksc.count%>)</h4>
                     </div>
                     </div>
         </div>
<% @tasksc.order(f_real: :desc).each do |task| %>
<%=link_to report_accion_task_path(@report,@accion,task) do %>
<div class="conteinter reporte cnt">
               <div class="row rtr">
                     <div class="col-md-12 rtd text-left" style = "    padding: 5px !important;
                        padding-left: 17px !important;font-size:13px; font-weight: 100;"><strong >Tarea:</strong> <%= task.name %></div>
                              <!-- <div class="col-md-3 text-right" style = "padding-left: 40px !importan;padding-top: 0px !important;
                                 padding-bottom: 0px !important;   padding-right: 40px !important;"> 
                                 <!--   <%= link_to  report_accion_task_path(@report,@accion,task), :class => "opciones" do %>
                                 <i class="fa fa-eye" aria-hidden="true"></i>
                                 <% if current_user.id == task.user_id%>
                                 <%= link_to  edit_report_accion_task_path(@report,@accion,task),remote:true, :class => "opciones" do %>
                                 <i class="fa fa-pencil" aria-hidden="true"></i>
                                 <% end %>
                                 
                                 <%= link_to  report_accion_task_path(@report,@accion,task),  method: :delete, data: { confirm: 'Are you sure?' }, :class => "opciones" do %>
                                 <i class="fa fa-trash" aria-hidden="true"></i>
                                 <% end %>
                                    <% end %>
                                 
                                 <% end %>
                                 </div>-->
                        <div class="col-md-12 rtd text-left" style = "    padding: 5px !important;
                           padding-left: 17px !important;font-size:13px;font-weight: 100;"><strong >Comentarios: </strong><%= task.observacion %></div>
               <!--<div class="col-md-3 rtd text-left" style = "    padding: 5px !important;
                  padding-left: 17px !important;font-size:13px;"><i class="fa fa-paperclip" aria-hidden="true"></i> </strong><%= (link_to "Evidencia",task.anexo_url, class:"linka") if task.anexo_url %></div>-->
               </div>
      <hr class="hr">
             <div class="row rtr">
                     <div class="col-md-4 rtd">
                     <strong><i class="fa fa-user" aria-hidden="true"></i>
                     </strong> <%  
                        employed = Employed.find(task.employed_id)
                        %>
                     
                           <%= employed.first_name %> <%= employed.first_last_name %>
                     </div>
                     <%color = ""
                        task.contador_seg < 0 ?  color = "#d82c2c" : color = "#0db4a0"%>
                     <div class="col-md-3 rtd" ><strong><i class="fa fa-calendar" aria-hidden="true"></i>
                     </strong> <%=  get_date(task.f_compromiso)  %></div>
                     <div class="col-md-3 rtd" ><strong>
                     </strong><i class="fa fa-calendar-check-o" aria-hidden="true"></i>
                     <%=  get_date(task.f_real)  %> <%= cumplio(task.cumplio).html_safe%></div>
                     <div class="col-md-2 rtd" style = "    font-size: 12px;
                        color: gray;"><%=  task.codigo  %></div>
               </div>
</div>
<% end %>
<% end %>
</div>

<!--/Tareas Cerradas-->

</div>
<!--/Tareas-->
<script>
   $(function () {
   $('[data-toggle="popover"]').popover({
     trigger: 'hover',
     html: true
     
   
   })
   })
   
</script>
<style>
.cierra
{
font-size: 16px;
font-weight: bold;
}
.imaacc img
{
border-radius: 40px;
}
.cnt
{
border: 1px solid #c3c3c3;
margin-bottom: 10px;
}
.rtr
{
}
.rtd
{
padding: 10px;
}
.titulo
{
background:#f2f2f2;
}
hr
{
margin-top: 0px;
margin-bottom: 0px;
}
</style>